# Migration `20201123155004`

This migration has been generated by vh13294 at 11/23/2020, 10:50:04 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `archives` (
    `comment` VARCHAR(191),
    `created_at` DATETIME(3),
    `created_by` INT NOT NULL,
    `customer_id` INT,
    `date` DATETIME(3) NOT NULL,
    `id` INT NOT NULL AUTO_INCREMENT,
    `location_id` INT NOT NULL,
    `product_id` INT NOT NULL,
    `quantity` INT NOT NULL,
    `supplier_id` INT,
    `updated_at` DATETIME(3),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `customers` (
    `created_at` DATETIME(3),
    `id` INT NOT NULL AUTO_INCREMENT,
    `khmer` VARCHAR(191),
    `name` VARCHAR(191) NOT NULL,
    `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active',
    `updated_at` DATETIME(3),
UNIQUE INDEX `customers.khmer_unique`(`khmer`),
UNIQUE INDEX `customers.name_unique`(`name`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `inventories` (
    `comment` VARCHAR(191),
    `created_at` DATETIME(3) DEFAULT CURRENT_TIMESTAMP(3),
    `created_by` INT NOT NULL,
    `customer_id` INT,
    `date` DATETIME(3) NOT NULL,
    `deleted_at` DATETIME(3),
    `id` INT NOT NULL AUTO_INCREMENT,
    `location_id` INT NOT NULL,
    `product_id` INT NOT NULL,
    `quantity` INT NOT NULL,
    `supplier_id` INT,
    `updated_at` DATETIME(3),
INDEX `inventories_created_by_foreign`(`created_by`),
INDEX `inventories_customer_id_foreign`(`customer_id`),
INDEX `inventories_location_id_foreign`(`location_id`),
INDEX `inventories_product_id_foreign`(`product_id`),
INDEX `inventories_supplier_id_foreign`(`supplier_id`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `locations` (
    `created_at` DATETIME(3),
    `id` INT NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(191) NOT NULL,
    `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active',
    `updated_at` DATETIME(3),
UNIQUE INDEX `locations.name_unique`(`name`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `migrations` (
    `batch` INT NOT NULL,
    `id` INT NOT NULL AUTO_INCREMENT,
    `migration` VARCHAR(191) NOT NULL,

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `products` (
    `created_at` DATETIME(3),
    `id` INT NOT NULL AUTO_INCREMENT,
    `khmer` VARCHAR(191) NOT NULL,
    `low_stock_warning` INT NOT NULL,
    `name` VARCHAR(191) NOT NULL,
    `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active',
    `updated_at` DATETIME(3),
UNIQUE INDEX `products.khmer_unique`(`khmer`),
UNIQUE INDEX `products.name_unique`(`name`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `suppliers` (
    `created_at` DATETIME(3),
    `id` INT NOT NULL AUTO_INCREMENT,
    `khmer` VARCHAR(191),
    `name` VARCHAR(191) NOT NULL,
    `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active',
    `updated_at` DATETIME(3),
UNIQUE INDEX `suppliers.khmer_unique`(`khmer`),
UNIQUE INDEX `suppliers.name_unique`(`name`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `users` (
    `api_token` VARCHAR(191),
    `created_at` DATETIME(3),
    `email` VARCHAR(191) NOT NULL,
    `id` INT NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(191) NOT NULL,
    `password` VARCHAR(191) NOT NULL,
    `registered_at` DATETIME(3),
    `updated_at` DATETIME(3),
UNIQUE INDEX `users.api_token_unique`(`api_token`),
UNIQUE INDEX `users.email_unique`(`email`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `inventories` ADD FOREIGN KEY (`created_by`) REFERENCES `users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `inventories` ADD FOREIGN KEY (`customer_id`) REFERENCES `customers`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `inventories` ADD FOREIGN KEY (`location_id`) REFERENCES `locations`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `inventories` ADD FOREIGN KEY (`product_id`) REFERENCES `products`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `inventories` ADD FOREIGN KEY (`supplier_id`) REFERENCES `suppliers`(`id`) ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201123155004
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,134 @@
+generator client {
+  provider = "prisma-client-js"
+//  previewFeatures = ["aggregateApi"]
+}
+
+datasource db {
+  provider = "mysql"
+  url = "***"
+}
+
+model Archive {
+  @@map(name: "archives")
+  comment     String?
+  created_at  DateTime?
+  created_by  Int
+  customer_id Int?
+  date        DateTime
+  id          Int       @default(autoincrement()) @id
+  location_id Int
+  product_id  Int
+  quantity    Int
+  supplier_id Int?
+  updated_at  DateTime?
+}
+
+model Customer {
+  @@map(name: "customers")
+  created_at  DateTime?
+  id          Int              @default(autoincrement()) @id
+  khmer       String?          @unique
+  name        String           @unique
+  status      customers_status @default(active)
+  updated_at  DateTime?
+  inventories Inventory[]
+}
+
+model Inventory {
+  @@map(name: "inventories")
+  comment     String?
+  created_at  DateTime? @default(now())
+  created_by  Int
+  customer_id Int?
+  date        DateTime
+  deleted_at  DateTime?
+  id          Int       @default(autoincrement()) @id
+  location_id Int
+  product_id  Int
+  quantity    Int
+  supplier_id Int?
+  updated_at  DateTime? @updatedAt
+  user        User      @relation(fields: [created_by], references: [id])
+  customer    Customer? @relation(fields: [customer_id], references: [id])
+  location    Location  @relation(fields: [location_id], references: [id])
+  product     Product   @relation(fields: [product_id], references: [id])
+  supplier    Supplier? @relation(fields: [supplier_id], references: [id])
+
+  @@index([created_by], name: "inventories_created_by_foreign")
+  @@index([customer_id], name: "inventories_customer_id_foreign")
+  @@index([location_id], name: "inventories_location_id_foreign")
+  @@index([product_id], name: "inventories_product_id_foreign")
+  @@index([supplier_id], name: "inventories_supplier_id_foreign")
+}
+
+model Location {
+  @@map(name: "locations")
+  created_at  DateTime?
+  id          Int              @default(autoincrement()) @id
+  name        String           @unique
+  status      locations_status @default(active)
+  updated_at  DateTime?
+  inventories Inventory[]
+}
+
+model migrations {
+  batch     Int
+  id        Int    @default(autoincrement()) @id
+  migration String
+}
+
+model Product {
+  @@map(name: "products")
+  created_at        DateTime?
+  id                Int             @default(autoincrement()) @id
+  khmer             String          @unique
+  low_stock_warning Int             @default(dbgenerated())
+  name              String          @unique
+  status            products_status @default(active)
+  updated_at        DateTime?
+  inventories       Inventory[]
+}
+
+model Supplier {
+  @@map(name: "suppliers")
+  created_at  DateTime?
+  id          Int              @default(autoincrement()) @id
+  khmer       String?          @unique
+  name        String           @unique
+  status      suppliers_status @default(active)
+  updated_at  DateTime?
+  inventories Inventory[]
+}
+
+model User {
+  @@map(name: "users")
+  api_token     String?     @unique
+  created_at    DateTime?
+  email         String      @unique
+  id            Int         @default(autoincrement()) @id
+  name          String
+  password      String
+  registered_at DateTime?
+  updated_at    DateTime?
+  inventories   Inventory[]
+}
+
+enum customers_status {
+  active
+  inactive
+}
+
+enum locations_status {
+  active
+  inactive
+}
+
+enum products_status {
+  active
+  inactive
+}
+
+enum suppliers_status {
+  active
+  inactive
+}
```


