# Migration `20201124060652`

This migration has been generated by vh13294 at 11/24/2020, 1:06:52 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `archives` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `product_id` INT NOT NULL,
    `location_id` INT NOT NULL,
    `customer_id` INT,
    `supplier_id` INT,
    `date` DATETIME(3) NOT NULL,
    `quantity` INT NOT NULL,
    `comment` VARCHAR(191),
    `created_by` INT NOT NULL,
    `created_at` DATETIME(3),
    `updated_at` DATETIME(3),
INDEX `archives_created_by_foreign`(`created_by`),
INDEX `archives_customer_id_foreign`(`customer_id`),
INDEX `archives_location_id_foreign`(`location_id`),
INDEX `archives_product_id_foreign`(`product_id`),
INDEX `archives_supplier_id_foreign`(`supplier_id`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `customers` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(191) NOT NULL,
    `khmer` VARCHAR(191),
    `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active',
    `created_at` DATETIME(3),
    `updated_at` DATETIME(3),
UNIQUE INDEX `customers.name_unique`(`name`),
UNIQUE INDEX `customers.khmer_unique`(`khmer`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `inventories` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `product_id` INT NOT NULL,
    `location_id` INT NOT NULL,
    `customer_id` INT,
    `supplier_id` INT,
    `date` DATETIME(3) NOT NULL,
    `quantity` INT NOT NULL,
    `comment` VARCHAR(191),
    `created_by` INT NOT NULL,
    `created_at` DATETIME(3),
    `updated_at` DATETIME(3),
    `deleted_at` DATETIME(3),
INDEX `inventories_created_by_foreign`(`created_by`),
INDEX `inventories_customer_id_foreign`(`customer_id`),
INDEX `inventories_location_id_foreign`(`location_id`),
INDEX `inventories_product_id_foreign`(`product_id`),
INDEX `inventories_supplier_id_foreign`(`supplier_id`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `locations` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(191) NOT NULL,
    `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active',
    `created_at` DATETIME(3),
    `updated_at` DATETIME(3),
UNIQUE INDEX `locations.name_unique`(`name`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `products` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(191) NOT NULL,
    `khmer` VARCHAR(191) NOT NULL,
    `low_stock_warning` INT NOT NULL,
    `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active',
    `created_at` DATETIME(3),
    `updated_at` DATETIME(3),
UNIQUE INDEX `products.name_unique`(`name`),
UNIQUE INDEX `products.khmer_unique`(`khmer`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `suppliers` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(191) NOT NULL,
    `khmer` VARCHAR(191),
    `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active',
    `created_at` DATETIME(3),
    `updated_at` DATETIME(3),
UNIQUE INDEX `suppliers.name_unique`(`name`),
UNIQUE INDEX `suppliers.khmer_unique`(`khmer`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `users` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(191) NOT NULL,
    `email` VARCHAR(191) NOT NULL,
    `password` VARCHAR(191) NOT NULL,
    `api_token` VARCHAR(191),
    `registered_at` DATETIME(3),
    `created_at` DATETIME(3),
    `updated_at` DATETIME(3),
UNIQUE INDEX `users.email_unique`(`email`),
UNIQUE INDEX `users.api_token_unique`(`api_token`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `invoice_items` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `invoice_id` INT NOT NULL,
    `inventory_id` INT NOT NULL,
    `unit_id` INT NOT NULL,
    `price_USD` DECIMAL(65,30),
    `price_riel` INT,
    `created_at` DATETIME(3),
    `updated_at` DATETIME(3),
    `deleted_at` DATETIME(3),
INDEX `invoice_items_inventory_id_foreign`(`inventory_id`),
INDEX `invoice_items_invoice_id_foreign`(`invoice_id`),
INDEX `invoice_items_unit_id_foreign`(`unit_id`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `invoices` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `date` DATETIME(3) NOT NULL,
    `status` ENUM('draft', 'active') NOT NULL DEFAULT 'active',
    `customer_id` INT,
    `customer_name_no_id` VARCHAR(191),
    `notes` VARCHAR(191),
    `draft_items` JSON,
    `paid_at` DATETIME(3),
    `created_by` INT NOT NULL,
    `created_at` DATETIME(3),
    `updated_at` DATETIME(3),
    `deleted_at` DATETIME(3),
INDEX `invoices_created_by_foreign`(`created_by`),
INDEX `invoices_customer_id_foreign`(`customer_id`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `prices` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `product_id` INT NOT NULL,
    `unit_id` INT NOT NULL,
    `effective_date` DATETIME(3) NOT NULL,
    `price_USD` DECIMAL(65,30),
    `price_riel` INT,
    `created_by` INT NOT NULL,
    `created_at` DATETIME(3),
    `updated_at` DATETIME(3),
UNIQUE INDEX `prices_product_id_unit_id_effective_date_unique`(`product_id`,
`unit_id`,
`effective_date`),
INDEX `prices_created_by_foreign`(`created_by`),
INDEX `prices_unit_id_foreign`(`unit_id`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `units` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `amount` DECIMAL(65,30) NOT NULL,
    `unit` ENUM('g', 'kg', 'tonne', 'mL', 'L') NOT NULL,
    `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active',
    `created_at` DATETIME(3),
    `updated_at` DATETIME(3),
UNIQUE INDEX `units_amount_unit_unique`(`amount`,
`unit`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `archives` ADD FOREIGN KEY (`created_by`) REFERENCES `users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `archives` ADD FOREIGN KEY (`customer_id`) REFERENCES `customers`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `archives` ADD FOREIGN KEY (`location_id`) REFERENCES `locations`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `archives` ADD FOREIGN KEY (`product_id`) REFERENCES `products`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `archives` ADD FOREIGN KEY (`supplier_id`) REFERENCES `suppliers`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `inventories` ADD FOREIGN KEY (`created_by`) REFERENCES `users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `inventories` ADD FOREIGN KEY (`customer_id`) REFERENCES `customers`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `inventories` ADD FOREIGN KEY (`location_id`) REFERENCES `locations`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `inventories` ADD FOREIGN KEY (`product_id`) REFERENCES `products`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `inventories` ADD FOREIGN KEY (`supplier_id`) REFERENCES `suppliers`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `invoice_items` ADD FOREIGN KEY (`inventory_id`) REFERENCES `inventories`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `invoice_items` ADD FOREIGN KEY (`invoice_id`) REFERENCES `invoices`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `invoice_items` ADD FOREIGN KEY (`unit_id`) REFERENCES `units`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `invoices` ADD FOREIGN KEY (`created_by`) REFERENCES `users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `invoices` ADD FOREIGN KEY (`customer_id`) REFERENCES `customers`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `prices` ADD FOREIGN KEY (`created_by`) REFERENCES `users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `prices` ADD FOREIGN KEY (`product_id`) REFERENCES `products`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `prices` ADD FOREIGN KEY (`unit_id`) REFERENCES `units`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201124060652
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,243 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "mysql"
+  url = "***"
+}
+
+model Archive {
+  id          Int       @id @default(autoincrement())
+  product_id  Int
+  location_id Int
+  customer_id Int?
+  supplier_id Int?
+  date        DateTime
+  quantity    Int
+  comment     String?
+  created_by  Int
+  created_at  DateTime?
+  updated_at  DateTime?
+  users       User      @relation("archivesTousers", fields: [created_by], references: [id])
+  customers   Customer? @relation("archivesTocustomers", fields: [customer_id], references: [id])
+  locations   Location  @relation("archivesTolocations", fields: [location_id], references: [id])
+  products    Product   @relation("archivesToproducts", fields: [product_id], references: [id])
+  suppliers   Supplier? @relation("archivesTosuppliers", fields: [supplier_id], references: [id])
+
+  @@index([created_by], name: "archives_created_by_foreign")
+  @@index([customer_id], name: "archives_customer_id_foreign")
+  @@index([location_id], name: "archives_location_id_foreign")
+  @@index([product_id], name: "archives_product_id_foreign")
+  @@index([supplier_id], name: "archives_supplier_id_foreign")
+  @@map("archives")
+}
+
+model Customer {
+  id          Int              @id @default(autoincrement())
+  name        String           @unique
+  khmer       String?          @unique
+  status      customers_status @default(active)
+  created_at  DateTime?
+  updated_at  DateTime?
+  archives    Archive[]        @relation("archivesTocustomers")
+  inventories Inventory[]
+  invoices    invoices[]       @relation("customersToinvoices")
+
+  @@map("customers")
+}
+
+model Inventory {
+  id            Int             @id @default(autoincrement())
+  product_id    Int
+  location_id   Int
+  customer_id   Int?
+  supplier_id   Int?
+  date          DateTime
+  quantity      Int
+  comment       String?
+  created_by    Int
+  created_at    DateTime?
+  updated_at    DateTime?       @updatedAt
+  deleted_at    DateTime?
+  user          User            @relation(fields: [created_by], references: [id])
+  customer      Customer?       @relation(fields: [customer_id], references: [id])
+  location      Location        @relation(fields: [location_id], references: [id])
+  product       Product         @relation(fields: [product_id], references: [id])
+  supplier      Supplier?       @relation(fields: [supplier_id], references: [id])
+  invoice_items invoice_items[] @relation("inventoriesToinvoice_items")
+
+  @@index([created_by], name: "inventories_created_by_foreign")
+  @@index([customer_id], name: "inventories_customer_id_foreign")
+  @@index([location_id], name: "inventories_location_id_foreign")
+  @@index([product_id], name: "inventories_product_id_foreign")
+  @@index([supplier_id], name: "inventories_supplier_id_foreign")
+  @@map("inventories")
+}
+
+model Location {
+  id          Int              @id @default(autoincrement())
+  name        String           @unique
+  status      locations_status @default(active)
+  created_at  DateTime?
+  updated_at  DateTime?
+  archives    Archive[]        @relation("archivesTolocations")
+  inventories Inventory[]
+
+  @@map("locations")
+}
+
+model Product {
+  id                Int             @id @default(autoincrement())
+  name              String          @unique
+  khmer             String          @unique
+  low_stock_warning Int             @default(dbgenerated())
+  status            products_status @default(active)
+  created_at        DateTime?
+  updated_at        DateTime?
+  archives          Archive[]       @relation("archivesToproducts")
+  inventories       Inventory[]
+  prices            prices[]        @relation("pricesToproducts")
+
+  @@map("products")
+}
+
+model Supplier {
+  id          Int              @id @default(autoincrement())
+  name        String           @unique
+  khmer       String?          @unique
+  status      suppliers_status @default(active)
+  created_at  DateTime?
+  updated_at  DateTime?
+  archives    Archive[]        @relation("archivesTosuppliers")
+  inventories Inventory[]
+
+  @@map("suppliers")
+}
+
+model User {
+  id            Int         @id @default(autoincrement())
+  name          String
+  email         String      @unique
+  password      String
+  api_token     String?     @unique
+  registered_at DateTime?
+  created_at    DateTime?
+  updated_at    DateTime?
+  archives      Archive[]   @relation("archivesTousers")
+  inventories   Inventory[]
+  invoices      invoices[]  @relation("invoicesTousers")
+  prices        prices[]    @relation("pricesTousers")
+
+  @@map("users")
+}
+
+model invoice_items {
+  id           Int       @id @default(autoincrement())
+  invoice_id   Int
+  inventory_id Int
+  unit_id      Int
+  price_USD    Float?
+  price_riel   Int?
+  created_at   DateTime?
+  updated_at   DateTime?
+  deleted_at   DateTime?
+  inventories  Inventory @relation("inventoriesToinvoice_items", fields: [inventory_id], references: [id])
+  invoices     invoices  @relation(fields: [invoice_id], references: [id])
+  units        units     @relation(fields: [unit_id], references: [id])
+
+  @@index([inventory_id], name: "invoice_items_inventory_id_foreign")
+  @@index([invoice_id], name: "invoice_items_invoice_id_foreign")
+  @@index([unit_id], name: "invoice_items_unit_id_foreign")
+}
+
+model invoices {
+  id                  Int             @id @default(autoincrement())
+  date                DateTime
+  status              invoices_status @default(active)
+  customer_id         Int?
+  customer_name_no_id String?
+  notes               String?
+  draft_items         Json?
+  paid_at             DateTime?
+  created_by          Int
+  created_at          DateTime?
+  updated_at          DateTime?
+  deleted_at          DateTime?
+  users               User            @relation("invoicesTousers", fields: [created_by], references: [id])
+  customers           Customer?       @relation("customersToinvoices", fields: [customer_id], references: [id])
+  invoice_items       invoice_items[]
+
+  @@index([created_by], name: "invoices_created_by_foreign")
+  @@index([customer_id], name: "invoices_customer_id_foreign")
+}
+
+model prices {
+  id             Int       @id @default(autoincrement())
+  product_id     Int
+  unit_id        Int
+  effective_date DateTime
+  price_USD      Float?
+  price_riel     Int?
+  created_by     Int
+  created_at     DateTime?
+  updated_at     DateTime?
+  users          User      @relation("pricesTousers", fields: [created_by], references: [id])
+  products       Product   @relation("pricesToproducts", fields: [product_id], references: [id])
+  units          units     @relation(fields: [unit_id], references: [id])
+
+  @@unique([product_id, unit_id, effective_date], name: "prices_product_id_unit_id_effective_date_unique")
+  @@index([created_by], name: "prices_created_by_foreign")
+  @@index([unit_id], name: "prices_unit_id_foreign")
+}
+
+model units {
+  id            Int             @id @default(autoincrement())
+  amount        Float
+  unit          units_unit
+  status        units_status    @default(active)
+  created_at    DateTime?
+  updated_at    DateTime?
+  invoice_items invoice_items[]
+  prices        prices[]
+
+  @@unique([amount, unit], name: "units_amount_unit_unique")
+}
+
+enum customers_status {
+  active
+  inactive
+}
+
+enum locations_status {
+  active
+  inactive
+}
+
+enum products_status {
+  active
+  inactive
+}
+
+enum suppliers_status {
+  active
+  inactive
+}
+
+enum invoices_status {
+  draft
+  active
+}
+
+enum units_unit {
+  g
+  kg
+  tonne
+  mL
+  L
+}
+
+enum units_status {
+  active
+  inactive
+}
```


